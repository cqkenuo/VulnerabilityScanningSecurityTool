#include "gshared.h"
#include "mytextedit.h"

#include <QKeyEvent>
MYTextEdit::MYTextEdit(QWidget*parent):QTextEdit(parent)
{
    //this->setFont(GShared::ubuntu_font);
}

void MYTextEdit::keyPressEvent(QKeyEvent *event)
{
    // 获取键盘按键的编码值
    int input_key = event->key();

    // 如果是上下左右键直接由QTextEdit默认处理
    if ( (input_key == Qt::Key_Left) || (input_key == Qt::Key_Up) || (input_key == Qt::Key_Right) || (input_key == Qt::Key_Down) )
    {
        QTextEdit::keyPressEvent(event);
        return;
    }

    // 编辑框允许接受键盘输入
    if (_is_accept_key_input)
    {
        // 如果是 [回车键] 就发出执行命令的信号，执行[cmdwindow]中[on_exe_cammand]槽函数 
        if (input_key == Qt::Key_Return)
        {
            emit exe_cammand();
            return;
        }

        // 用户按下的是退格键时，要判断此时能否接受退格键
        // c:/nisodaisuki>|  此时不能接收退格键
        if (event->key() == Qt::Key_Backspace)
        {
            if (_isEnable_BK)
            {
                QTextEdit::keyPressEvent(event);
            }
            else
            {
                event->ignore();
            }
        }
        else
        {
            QTextEdit::keyPressEvent(event);
        }
    }
    // 编辑框不允许接受键盘输入
    else
    {
        event->ignore();
    }
}
