#include "editcustomipstxtwindow.h"
#include "ui_editcustomipstxtwindow.h"




EditCustomIpsTxtWindow::EditCustomIpsTxtWindow(QWidget *parent) :
    QWidget(parent),
    ui(new Ui::EditCustomIpsTxtWindow)
{
    ui->setupUi(this);

    // 读取本地文件[iplist]，显示到用户的界面上
    set_edit_ips_txt_view();
}

EditCustomIpsTxtWindow::~EditCustomIpsTxtWindow()
{
    delete ui;
}

/**
 * @brief 读取本地文件[iplist]，显示到用户的界面上。
 */
void EditCustomIpsTxtWindow::set_edit_ips_txt_view()
{
    QString displayString;
    QFile file(GShared::program_path + "/" + QString::fromLocal8Bit(FILE_NAME_IPS_LIST_TXT));
    if (!file.open(QIODevice::ReadOnly | QIODevice::Text))
    {
        QMessageBox::information(this, QString::fromLocal8Bit("FILE OPEN FAILED"), "OPEN [ipslist] FILE FAILED.");
        return;
    }
        

    QTextStream in(&file);
    QString line = in.readLine();

    while (!line.isNull())
    {
        displayString.append(line+"\r\n");
        line = in.readLine();
    }

    // 清空界面上的编辑框
    ui->edit_ips_text->clear();

    // 将文本内容显示到界面上
    ui->edit_ips_text->setText(displayString);

    file.close();
}

/**
 * @brief 当用户点击了 [保存] 按钮时调用该函数。
 */
void EditCustomIpsTxtWindow::on_pushButton_clicked()
{
    // 将界面上的文本转成字符串。    
    QString input_string = ui->edit_ips_text->toPlainText();

    // 删除原来的[iplist]文件
    // 再将用户的界面上的内容写入到文件中
    QFile file(GShared::program_path + "/" + QString::fromLocal8Bit(FILE_NAME_IPS_LIST_TXT));
    file.remove();
    if (!file.open(QIODevice::WriteOnly | QIODevice::Text))
        return;

    file.write(input_string.toStdString().c_str());

    file.close();
}
